@(allMyVotes:Set[(String,Option[Double])], relatedProposals:Map[String,Proposal], talkType:String)(implicit lang: Lang, flash: Flash, req:RequestHeader)

@main("All my votes") {
    <div class="row">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h1 class="panel-title"><i class="icon-bar-chart"></i> Your votes</h1>
            </div>

            <div class="panel-body">
                <div class="col-md-12">
                    <h3><i class="icon-beaker"></i> Your personnal leaderboard</h3>
                    @if(allMyVotes.nonEmpty){
                        You have voted for @allMyVotes.filter(_._2.isDefined).size talks<br>
                        @defining(allMyVotes.filter(_._2.isDefined).toList.map(_._2.get)){ allScores =>
                            Sum of all your points: @Math.round(allScores.sum)<br>
                            Your average vote is @library.Stats.average(allScores)<br>
                            Standard deviation for your vote is @library.Stats.standardDeviation(allScores)<br>
                        }
                    }else{
                        You haven't voted for any proposal so far.
                    }

                    @models.ConferenceDescriptor.ConferenceProposalTypes.ALL.map{confType=>
                        <a href="@routes.CFPAdmin.allMyVotes(confType.id)" class="btn btn-sm @if(confType.id==talkType) { btn-success } else { btn-primary }">@Messages(confType.id)</a>
                    }

                </div>
                @if(allMyVotes.nonEmpty){
                    <div class="col-md-12">
                        <h3><i class="icon-bar-chart"></i> Proposals of type @Messages(talkType) for which you voted</h3>
                        <table class="table table-bordered proposals.@talkType" data-talk-type="@talkType">
                            <thead>
                                <tr>
                                    <th>Score</th>
                                    <th>Id</th>
                                    <th>Title</th>
                                    <th>Track</th>
                                    <th>Speakers</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                @allMyVotes.filter(_._2.isDefined).toList.sortBy(_._2).reverse.map { case (proposalId, maybeVote) =>
                                    @defining(Math.round(maybeVote.get)) { score =>
                                        <td class="btn-color-@score btn-sm"><small>@score</small></td>
                                    }
                                <td><a href="@routes.CFPAdmin.openForReview(proposalId)" class="btn btn-sm btn-primary">@proposalId</a></td>
                                    @relatedProposals.get(proposalId).map { proposal =>
                                        <td>
                                            <small>@proposal.title</small>
                                        </td>

                                        <td>
                                            <small>@Messages(proposal.track.label)</small>
                                        </td>
                                          <td>
                                            <small>@proposal.allSpeakers.map(_.cleanName).mkString(", ")</small>
                                        </td>
                                    }
                                </tr>
                                }
                            </tbody>
                        </table>

                    </div>
                }
            </div>
        </div>
    </div>
</div>


}
